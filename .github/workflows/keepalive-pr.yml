name: Keepalive PR

on:
  schedule:
    - cron: "0 15 * * 0" # 한국 기준 일요일 오전 9시
  workflow_dispatch:

jobs:
  create-keepalive-pr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set Git Identity
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create keepalive file & commit
        run: |
          BRANCH="keepalive-$(date +%Y%m%d)"
          git checkout -b "$BRANCH"
          
          # 변경 사항 만들기
          echo "// keepalive ping $(date)" >> .keepalive.txt

          git add .keepalive.txt
          git commit -m "chore: keepalive ping"
          git push origin "$BRANCH"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "chore: Keepalive PR"
          body: "🔄 자동 생성된 PR입니다. 워크플로우 만료 방지를 위한 keepalive ping입니다."
          base: main
          branch: keepalive-${{ steps.date.outputs.date }}